
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="de">
  <head>
    <meta charset="utf-8" />
    <title>Facetten im Sourcecode anpassen &#8212; Regal-Drupal  Dokumentation</title>
    <link rel="stylesheet" href="../_static/hbz.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../genindex.html" />
    <link rel="search" title="Suche" href="../search.html" />
    <link rel="prev" title="Facetten einrichten" href="../user-docs/configureFacets.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>
<div class="header" role="banner">
  <div class="logo">
    <svg xmlns="http://www.w3.org/2000/svg" width="185" height="65">
       <path d="M185.191 54.057v-7.596h-5.649c-2.402 0-5.973 0-7.336.065l12.726-18.829V21.79h-22.596v7.401h5.713c3.117 0 5.65-.064 6.883-.13L161.946 48.15v5.908h23.245M94.26 13.024v41.033h8.31V38.475c0-5.649 3.247-10.453 7.467-10.453 3.116 0 4.025 2.013 4.025 5.389v20.646h8.247V31.398c0-5.649-2.337-10.323-9.61-10.323-5.065 0-8.766 2.402-10.648 6.038l-.065-.065c.454-1.883.585-4.61.585-6.558V6.596c-4.805-.13-9.806.065-13.96.585v5.193c1.882.13 4.09.39 5.648.65" fill="#f18123"></path><path d="M137.622 6.503c-4.805-.13-9.804.065-13.96.584v5.194c1.883.13 4.09.39 5.65.65v40.125c3.7 1.039 7.336 1.558 12.011 1.558 11.103 0 17.466-7.532 17.466-18.44 0-9.544-4.155-15.128-11.882-15.128-4.545 0-8.116 2.208-9.74 5.714h-.064c.324-1.688.519-4.35.519-6.298V6.503zm12.402 30.515c0 7.987-3.377 10.973-8.117 10.973-1.753 0-3.116-.194-4.285-.584v-9.09c0-5.389 2.597-10.388 6.882-10.388 3.766 0 5.52 3.051 5.52 9.09" fill="#f18123" fill-rule="evenodd"></path><path d="M50.832 42.772V11.641H13.903V5.625l49.105-.001.003 37.148H50.83" fill="#004678"></path><path d="M21.654 44.5h43.084V5.636l7.428.001-.001 48.399h-50.51V44.5" fill="#004678"></path><path d="M19.928 13.368v42.395h43.083l-.002 9.763H13.903V13.368h6.025" fill="#004678"></path><path d="M63.008 3.897H12.177v50.139H0V.002L63.008 0v3.897" fill="#004678"></path>
    </svg>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Stichwortverzeichnis"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="../user-docs/configureFacets.html" title="Facetten einrichten"
             accesskey="P">zurück</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Regal-Drupal  Dokumentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="facetten-im-sourcecode-anpassen">
<h1>Facetten im Sourcecode anpassen<a class="headerlink" href="#facetten-im-sourcecode-anpassen" title="Link zu dieser Überschrift">¶</a></h1>
<p>Für die Anpassung der Facetten im Quellcode sind besonders diese Dateien relevant</p>
<ul class="simple">
<li><p>edoweb_storage/EdowebAPIClient.inc</p></li>
<li><p>edoweb/php/moduleSettings.php</p></li>
<li><p>edoweb/js/edoweb_view.js</p></li>
</ul>
<p>In der ersten Datei werden die Anfragen an an den Elasticsearch-Index generiert, die die für die Facetten benötigten Daten verwenden. Die derzeit verwendete
Elasticsearch 1.1 kennt für die Abfrage von Facetten ein mit „facets“ bezeichnetes Array, mit dem die entsprechende Abfrage generiert wird. In späteren Elasicsearch-Versionen
gibt es dieses Atrray nicht mehr. Im Unterschied zu dem „query“ genannten Array funktioniert hier die Sortierung der Ergebnisliste deutlich anders.</p>
<p>query kennt ein inneres Array namens „sort“, dass als weiteres Element „order“ enthält. „sort enthält die Information welches Feld sortiert werden soll, „order“ kann z.B. „desc“ oder „asc“ sein.</p>
<p>facet kennt nur „order“ mit den Begriffen „count“ [default], „term“ und „reverse_term“. Während count nach der Anzahl der treffer sortiert, sortieren term und reverse_term auf- und absteigend
nach dem Feldnamen.</p>
<p><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/0.90/search-facets-terms-facet.html">https://www.elastic.co/guide/en/elasticsearch/reference/0.90/search-facets-terms-facet.html</a></p>
<p>gibt eine genaue Übersicht.</p>
<p>In der zweiten Datei habe ich Formulare zur Konfiguration der Facetten angelegt, bzw. überarbeitet. Damit wird eine rollenspezifische Auswahl der Facetten ermöglicht.
Das ist kein Muss, mit der Konfigurierbarkeit wird jedoch eine deutlich vereinfachte Wartung der Facetten erreicht, die nach meiner Erfahrung immer wieder angepasst werden müssen.</p>
<p>In der dritten Datei gibt es die Möglichkeit, die Facetten auf Basis einer jquery-Funktionalität zu sortieren. Dadurch kann eine bereits getroffene Auswahl der Facetten nach den
relevantesten (die meisten Treffer) anschließend nach einem anderen Kriterium sortiert angezeigt werden. Mach jedoch in meinem Beispiel wenig Sinn.</p>
</div>
<div class="section" id="kontrolle-der-ergebnisse-einer-elasticsearch-abfrage">
<h1>Kontrolle der Ergebnisse einer Elasticsearch-Abfrage<a class="headerlink" href="#kontrolle-der-ergebnisse-einer-elasticsearch-abfrage" title="Link zu dieser Überschrift">¶</a></h1>
<p>Die Elasticsearch ist aus Sicherheitsgründen nur von localhost und ausgewählten IP-Adressen innerhalb des hbz erreichbar. Die erlaubten IP-Adressen sind in der Apache-Config „site.cfg“
eingetragen. Der Apache2-Server nutzt die site.cfg aus dem Verzeichnis /opt/regal/prod-conf, die über einen SymLink verknüpft ist.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Inhaltsverzeichnis</a></h3>
  <ul>
<li><a class="reference internal" href="#">Facetten im Sourcecode anpassen</a></li>
<li><a class="reference internal" href="#kontrolle-der-ergebnisse-einer-elasticsearch-abfrage">Kontrolle der Ergebnisse einer Elasticsearch-Abfrage</a></li>
</ul>

  <h4>Vorheriges Thema</h4>
  <p class="topless"><a href="../user-docs/configureFacets.html"
                        title="vorheriges Kapitel">Facetten einrichten</a></p>
  <div role="note" aria-label="source link">
    <h3>Diese Seite</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/developer-docs/developFacets.rst.txt"
            rel="nofollow">Quellcode anzeigen</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Schnellsuche</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Los" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Stichwortverzeichnis"
             >Index</a></li>
        <li class="right" >
          <a href="../user-docs/configureFacets.html" title="Facetten einrichten"
             >zurück</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Regal-Drupal  Dokumentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Andres Quast.
      Mit <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1 erstellt.
    </div>
  </body>
</html>